
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Understanding IQMs generated by MRIQC &#8212; ISMRM&#39;22 QC Book</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reducing the dimensionality of the metrics" href="dimensionality_reduction.html" />
    <link rel="prev" title="Introduction" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">ISMRM'22 QC Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../welcome.html">
                    Welcome!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  preamble
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../preamble/step0.html">
   Before we start: How to follow this tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preamble/qa-qc-basics.html">
   Before we dive into QA/QC : Definitions and terminology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preamble/define-qa-qc.html">
   Defining QC and QA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preamble/qc-and-neuroimaging.html">
   QC and Neuroimaging
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dataset QC
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dataset-qc/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataset-qc/Example1.html">
   Is a task repetitive, boring, and/or error-prone? Script it!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataset-qc/Example2.html">
   Highlight important and diagnostic features as efficiently as possible
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataset-qc/Example3.html">
   Create and consistently perform control analyses
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dataset-qc/Example4.html">
   Use automated dynamic reports
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Animal QA/QC
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../animal-qc/intro.html">
   Quality Control in preclinical MRI: Where do artifacts come from and how to fix them
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../animal-qc/acquisition.html">
   Idiosyncrasies of acquiring data from small animals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../animal-qc/acquisition_examples.html">
   “What went wrong?” data acquisition edition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../animal-qc/processing.html">
   Idiosyncrasies of processing MRI data from small animals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../animal-qc/processing_examples.html">
   “What went wrong?” data processing edition
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Automating QA
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Understanding IQMs generated by MRIQC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dimensionality_reduction.html">
   Reducing the dimensionality of the metrics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html">
   Making predictions about quality
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/nipreps/qc-book/main?urlpath=lab/tree/docs/auto-qc/iqms_first_contact.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://ismrm.dandiarchive.org/hub/user-redirect/git-pull?repo=https%3A//github.com/nipreps/qc-book&urlpath=lab/tree/qc-book/docs/auto-qc/iqms_first_contact.md&branch=main"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/nipreps/qc-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/auto-qc/iqms_first_contact.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/auto-qc/iqms_first_contact.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Understanding IQMs generated by MRIQC
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-first-look-on-the-dataset">
     A first look on the dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#homogenizing-across-sites">
     Homogenizing across sites
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#target-labels-manual-ratings-by-humans">
   Target labels: manual ratings by humans
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Understanding IQMs generated by MRIQC</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Understanding IQMs generated by MRIQC
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-first-look-on-the-dataset">
     A first look on the dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#homogenizing-across-sites">
     Homogenizing across sites
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#target-labels-manual-ratings-by-humans">
   Target labels: manual ratings by humans
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="understanding-iqms-generated-by-mriqc">
<h1>Understanding IQMs generated by MRIQC<a class="headerlink" href="#understanding-iqms-generated-by-mriqc" title="Permalink to this headline">#</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">mriqc-learn</span></code> package comes with some example data for users, derived from the MRIQC paper.
First, we will be using a dataset containing IQMs generated on the open-access ABIDE I dataset which contains manual assessments by human raters.
Let’s explore the dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. mriqc-learn comes with a convenience data loader, you&#39;ll need to first import it.</span>
<span class="kn">from</span> <span class="nn">mriqc_learn.datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>

<span class="c1"># 2. Once imported, let&#39;s pull up some data</span>
<span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">split_strategy</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>

<span class="c1"># 3. Remove non-informative IQMs (image size and spacing)</span>
<span class="n">train_x</span> <span class="o">=</span> <span class="n">train_x</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span>
    <span class="s2">&quot;size_x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;size_y&quot;</span><span class="p">,</span>
    <span class="s2">&quot;size_z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spacing_x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spacing_y&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spacing_z&quot;</span><span class="p">,</span>
<span class="p">])</span>

<span class="c1"># 4. Keep a list of numeric columns before adding the site as a column</span>
<span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">train_x</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>With the argument <code class="docutils literal notranslate"><span class="pre">split_strategy=&quot;none&quot;</span></code> we are indicating that we want to obtain the full dataset, without partitioning it in any ways.
That means variable <code class="docutils literal notranslate"><span class="pre">train_x</span></code> will contain <em>features</em> (in other words, the actual IQMs) and <code class="docutils literal notranslate"><span class="pre">train_y</span></code> contains manual assessments, for 1101 T1-weighted MRI images of ABIDE I.
Both data tables <code class="docutils literal notranslate"><span class="pre">train_x</span></code> and <code class="docutils literal notranslate"><span class="pre">train_y</span></code> have the structure of Pandas DataFrames.</p>
<p>In order to investigate those “site-effects”, let’s add a column to <code class="docutils literal notranslate"><span class="pre">train_x</span></code> with site information:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_x</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_y</span><span class="o">.</span><span class="n">site</span>
</pre></div>
</div>
</div>
</div>
<p>These sites correspond to the following acquisition parameters:</p>
<img alt="https://journals.plos.org/plosone/article/figure/image?size=large&amp;download=&amp;id=10.1371/journal.pone.0184661.t001" src="https://journals.plos.org/plosone/article/figure/image?size=large&amp;download=&amp;id=10.1371/journal.pone.0184661.t001" />
<section id="a-first-look-on-the-dataset">
<h2>A first look on the dataset<a class="headerlink" href="#a-first-look-on-the-dataset" title="Permalink to this headline">#</a></h2>
<p>Lets now have a first quick look over the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cjv</th>
      <th>cnr</th>
      <th>efc</th>
      <th>fber</th>
      <th>fwhm_avg</th>
      <th>fwhm_x</th>
      <th>fwhm_y</th>
      <th>fwhm_z</th>
      <th>icvs_csf</th>
      <th>icvs_gm</th>
      <th>...</th>
      <th>summary_wm_median</th>
      <th>summary_wm_n</th>
      <th>summary_wm_p05</th>
      <th>summary_wm_p95</th>
      <th>summary_wm_stdv</th>
      <th>tpm_overlap_csf</th>
      <th>tpm_overlap_gm</th>
      <th>tpm_overlap_wm</th>
      <th>wm2max</th>
      <th>site</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.383747</td>
      <td>3.259968</td>
      <td>0.609668</td>
      <td>181.619858</td>
      <td>3.944888</td>
      <td>3.959924</td>
      <td>4.039157</td>
      <td>3.835584</td>
      <td>0.199774</td>
      <td>0.449138</td>
      <td>...</td>
      <td>1000.013428</td>
      <td>189965.0</td>
      <td>908.938904</td>
      <td>1079.413428</td>
      <td>51.778980</td>
      <td>0.225944</td>
      <td>0.525072</td>
      <td>0.540801</td>
      <td>0.540213</td>
      <td>PITT</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.574080</td>
      <td>2.279440</td>
      <td>0.606361</td>
      <td>172.500031</td>
      <td>3.992397</td>
      <td>3.877495</td>
      <td>4.173095</td>
      <td>3.926602</td>
      <td>0.203301</td>
      <td>0.429628</td>
      <td>...</td>
      <td>1000.033569</td>
      <td>187992.0</td>
      <td>901.788293</td>
      <td>1120.833569</td>
      <td>67.136932</td>
      <td>0.223374</td>
      <td>0.521399</td>
      <td>0.560238</td>
      <td>0.571425</td>
      <td>PITT</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.314944</td>
      <td>3.998569</td>
      <td>0.577123</td>
      <td>273.688171</td>
      <td>4.016382</td>
      <td>4.066009</td>
      <td>4.092888</td>
      <td>3.890248</td>
      <td>0.201591</td>
      <td>0.446495</td>
      <td>...</td>
      <td>1000.015198</td>
      <td>188213.0</td>
      <td>913.847803</td>
      <td>1067.003662</td>
      <td>46.623932</td>
      <td>0.233414</td>
      <td>0.531020</td>
      <td>0.556496</td>
      <td>0.612655</td>
      <td>PITT</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.418505</td>
      <td>3.050534</td>
      <td>0.571343</td>
      <td>237.531143</td>
      <td>3.601741</td>
      <td>3.629409</td>
      <td>3.627568</td>
      <td>3.548246</td>
      <td>0.190612</td>
      <td>0.468255</td>
      <td>...</td>
      <td>1000.005981</td>
      <td>146722.0</td>
      <td>872.409717</td>
      <td>1083.139264</td>
      <td>63.131420</td>
      <td>0.227282</td>
      <td>0.528115</td>
      <td>0.526254</td>
      <td>0.600312</td>
      <td>PITT</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.286560</td>
      <td>4.214082</td>
      <td>0.550083</td>
      <td>427.042389</td>
      <td>3.808350</td>
      <td>3.839143</td>
      <td>3.841085</td>
      <td>3.744823</td>
      <td>0.162421</td>
      <td>0.505201</td>
      <td>...</td>
      <td>1000.004150</td>
      <td>162584.0</td>
      <td>900.433481</td>
      <td>1069.912750</td>
      <td>50.874363</td>
      <td>0.195150</td>
      <td>0.543591</td>
      <td>0.531606</td>
      <td>0.603308</td>
      <td>PITT</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1096</th>
      <td>0.428731</td>
      <td>3.030323</td>
      <td>0.789654</td>
      <td>2519.999512</td>
      <td>3.176760</td>
      <td>3.166740</td>
      <td>3.359990</td>
      <td>3.003550</td>
      <td>0.169851</td>
      <td>0.424819</td>
      <td>...</td>
      <td>1000.034668</td>
      <td>241117.0</td>
      <td>902.529590</td>
      <td>1088.244409</td>
      <td>56.683868</td>
      <td>0.162535</td>
      <td>0.476992</td>
      <td>0.536843</td>
      <td>0.537140</td>
      <td>SBL</td>
    </tr>
    <tr>
      <th>1097</th>
      <td>0.610845</td>
      <td>2.155928</td>
      <td>0.800116</td>
      <td>1769.720093</td>
      <td>3.209497</td>
      <td>3.164760</td>
      <td>3.381280</td>
      <td>3.082450</td>
      <td>0.170732</td>
      <td>0.405536</td>
      <td>...</td>
      <td>1000.039429</td>
      <td>251136.0</td>
      <td>903.951080</td>
      <td>1093.323273</td>
      <td>57.789230</td>
      <td>0.193376</td>
      <td>0.465232</td>
      <td>0.545695</td>
      <td>0.564010</td>
      <td>SBL</td>
    </tr>
    <tr>
      <th>1098</th>
      <td>0.461773</td>
      <td>2.794299</td>
      <td>0.789859</td>
      <td>2248.858398</td>
      <td>3.149920</td>
      <td>3.112220</td>
      <td>3.326700</td>
      <td>3.010840</td>
      <td>0.165501</td>
      <td>0.441190</td>
      <td>...</td>
      <td>1000.036438</td>
      <td>209298.0</td>
      <td>891.934216</td>
      <td>1093.973322</td>
      <td>61.108639</td>
      <td>0.198508</td>
      <td>0.497137</td>
      <td>0.523571</td>
      <td>0.564865</td>
      <td>SBL</td>
    </tr>
    <tr>
      <th>1099</th>
      <td>0.457718</td>
      <td>2.862913</td>
      <td>0.706924</td>
      <td>114.865364</td>
      <td>3.486750</td>
      <td>3.421200</td>
      <td>3.881950</td>
      <td>3.157100</td>
      <td>0.209701</td>
      <td>0.381839</td>
      <td>...</td>
      <td>999.990356</td>
      <td>234957.0</td>
      <td>904.907922</td>
      <td>1101.429980</td>
      <td>60.045422</td>
      <td>0.235618</td>
      <td>0.477310</td>
      <td>0.563352</td>
      <td>0.534626</td>
      <td>MAX_MUN</td>
    </tr>
    <tr>
      <th>1100</th>
      <td>0.419648</td>
      <td>3.129415</td>
      <td>0.783152</td>
      <td>116.484947</td>
      <td>3.579490</td>
      <td>3.538990</td>
      <td>3.991800</td>
      <td>3.207680</td>
      <td>0.215531</td>
      <td>0.402868</td>
      <td>...</td>
      <td>1000.005981</td>
      <td>244797.0</td>
      <td>904.572144</td>
      <td>1095.835376</td>
      <td>58.381458</td>
      <td>0.227491</td>
      <td>0.492317</td>
      <td>0.549036</td>
      <td>0.573174</td>
      <td>MAX_MUN</td>
    </tr>
  </tbody>
</table>
<p>1101 rows × 63 columns</p>
</div></div></div>
</div>
<p>This first look is not very informative - there’s no way we can pick any of the structure in our dataset.</p>
<p>First, let’s investigate the number of metrics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>62
</pre></div>
</div>
</div>
</div>
<p>Let’s now make use of one plotting utility of <code class="docutils literal notranslate"><span class="pre">mriqc-learn</span></code>, and observe the structure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Let&#39;s import a module containing visualization tools for IQMs</span>
<span class="kn">from</span> <span class="nn">mriqc_learn.viz</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="c1"># 2. Plot the dataset</span>
<span class="n">fig1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">plot_batches</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iqms_first_contact_10_0.png" src="../_images/iqms_first_contact_10_0.png" />
</div>
</div>
<p>The plot above is clearly blocky, very well aligned with the different acquisition sites that are comprehended.</p>
</section>
<section id="homogenizing-across-sites">
<h2>Homogenizing across sites<a class="headerlink" href="#homogenizing-across-sites" title="Permalink to this headline">#</a></h2>
<p>One first thought to make these IQMs more homogeneous would be to site-wise standardize them.
This means, for each site, calculate mean and standard deviation and apply them to convert IQMs to zero-mean, unit-variance distributions.
<code class="docutils literal notranslate"><span class="pre">mriqc-learn</span></code> has a filter (derived from, and compatible with <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>) to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the filter</span>
<span class="kn">from</span> <span class="nn">mriqc_learn.models.preprocess</span> <span class="kn">import</span> <span class="n">SiteRobustScaler</span>

<span class="c1"># Plot data after standardization</span>
<span class="n">standardized_x</span> <span class="o">=</span> <span class="n">SiteRobustScaler</span><span class="p">(</span><span class="n">unit_variance</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">fig2</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">plot_batches</span><span class="p">(</span><span class="n">standardized_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iqms_first_contact_12_0.png" src="../_images/iqms_first_contact_12_0.png" />
</div>
</div>
<p>Now the plot is not so <em>blocky</em>.</p>
<p>A different way of looking at this is plotting histograms of some metrics, with the original and the standardized version represented side-by-side.
For example, this would be the picture for the coefficient of joint variation (CJV), which is passed in as the <code class="docutils literal notranslate"><span class="pre">metric</span></code> argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">standardized_x</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cjv&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iqms_first_contact_14_0.png" src="../_images/iqms_first_contact_14_0.png" />
</div>
</div>
<p>It is clear that, on the left, sites tend to cluster in regions of the spread of values (<em>X</em>-axis).
Conversely, on the right-hand histogram, sites overlap much more and form together some sort of gaussian distribution.</p>
<p>The situation is even more clear for the following definition of SNR (<code class="docutils literal notranslate"><span class="pre">snrd_total</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">standardized_x</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;snrd_total&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iqms_first_contact_16_0.png" src="../_images/iqms_first_contact_16_0.png" />
</div>
</div>
<p>Now, this is how the <em>entropy-focus criterion</em> (EFC) looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">standardized_x</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;efc&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iqms_first_contact_18_0.png" src="../_images/iqms_first_contact_18_0.png" />
</div>
</div>
<p>Finally, a look on a very commonly used parameter, the <em>contrast-to-noise ratio</em> (CNR):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">standardized_x</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cnr&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iqms_first_contact_20_0.png" src="../_images/iqms_first_contact_20_0.png" />
</div>
</div>
<div class="admonition-what-s-the-problem admonition">
<p class="admonition-title">What’s the problem?</p>
<p>Any model we train on those features heavily reliant on the site of acquisition will rather pick up the site where the image was acquired than the quality (which is our target).
This is so because perceived image quality by humans (the target outcome we want to predict) is very correlated with the site of acquisition.
In other words, our machine-learning model will operate like a human would do: <em>given that this site produces mostly poor images, I will assume all images coming from it are poor</em>.</p>
</div>
<p>At this point, it is clear that we are about to try training models on rather noisy features, which also show strong biases correlated with the acquisition site.</p>
<p>Unfortunately, there are further complications.
Indeed, the targets (image quality assessments) that we can use in training are also very noisy.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="target-labels-manual-ratings-by-humans">
<h1>Target labels: manual ratings by humans<a class="headerlink" href="#target-labels-manual-ratings-by-humans" title="Permalink to this headline">#</a></h1>
<p>Let’s go further in exploring the effect of <em>labels noise</em>, by now focusing our attention on the dataset targets (<code class="docutils literal notranslate"><span class="pre">train_y</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mriqc_learn.viz</span> <span class="kn">import</span> <span class="n">ratings</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">raters_variability_plot</span><span class="p">(</span><span class="n">train_y</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/iqms_first_contact_22_0.png" src="../_images/iqms_first_contact_22_0.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./auto-qc"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Introduction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="dimensionality_reduction.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reducing the dimensionality of the metrics</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The tutorial authors<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>